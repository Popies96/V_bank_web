{% extends 'base.html.twig' %}

{% block title %}Marche index{% endblock %}



{% block body %}
    <script type="text/javascript"
            src="https://studio.alan.app/web/lib/alan_lib.min.js"></script>
    <script>
        var alanBtnInstance = alanBtn({
            key: "c06b1584a3a750524ec4c01301330d6d2e956eca572e1d8b807a3e2338fdd0dc/stage",
            onCommand: function (commandData) {
                if (commandData.command === "openURL" && url === "#trading") {
                    scrollToSection("trading");
                }
                if (commandData.command === "openURL") {
                    scrollToSection("market");
                }
                if (commandData.command === "openURL") {
                    scrollToSection("portfolio");
                }
            },
            rootEl: document.getElementById("alan-btn"),

        });
        function scrollToSection(sectionId) {
            var section = document.getElementById(sectionId);
            if (section) {
                // Scroll to the section smoothly
                section.scrollIntoView({ behavior: 'smooth' });
            }}
    </script>
    <style>


        #tradingview_33f92{

            width: 100%;
            height: 90vh;

        }



        .content-section {
            display: flex;
            justify-content: space-between;
            align-items: flex-start; /* or any other value depending on your spacing preference */
        }

        .left-content {
            flex: 1; /* or use grid-column property for grid layout */
        }
        .card-style-one {
            max-height: 600px; /* Adjust the max-height as needed */
            overflow-y: auto;
        }

        .right-content {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            padding-right: 8px;
        }
        .single-card {
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
            margin-top: 30px;
            -webkit-transition: all 0.3s ease-out 0s;
            -moz-transition: all 0.3s ease-out 0s;
            -ms-transition: all 0.3s ease-out 0s;
            -o-transition: all 0.3s ease-out 0s;
            transition: all 0.3s ease-out 0s;
        }
        .single-card:hover {
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }
        .single-card .card-image img {
            width: 100%;
            height: auto; /* Adjust height as needed */
        }
        .single-card .card-content {
            padding: 16px;
        }
        .single-card .card-content .card-title {
            margin-bottom: 0;
        }
        .single-card .card-content .card-title a {
            color: black;
            -webkit-transition: all 0.3s ease-out 0s;
            -moz-transition: all 0.3s ease-out 0s;
            -ms-transition: all 0.3s ease-out 0s;
            -o-transition: all 0.3s ease-out 0s;
            transition: all 0.3s ease-out 0s;
        }
        .single-card .card-content .card-title a:hover {
            color: #007bff; /* Adjust color as needed */
        }
        .single-card .card-content .text {
            color: black;
            margin-top: 8px;
        }
        .trading{
            margin: 0;
            background-color: #131722;
            background-size: cover;
            background-position: center;



        }

    </style>

    <section id="trading" class="trading pt-5">
<div class=" mt-5"></div>
    <!-- TradingView Widget BEGIN -->
    <div id="tradingview_33f92" class="tradingview-widget-container"></div>
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script type="text/javascript">
        new TradingView.widget(
            {
                "autosize": true,
                "symbol": "BITSTAMP:BTCUSD",
                "interval": "D",
                "timezone": "Etc/UTC",
                "theme": "dark",
                "style": "1",
                "locale": "en",
                "toolbar_bg": "#f1f3f6",
                "enable_publishing": false,
                "withdateranges": true,
                "hide_side_toolbar": false,
                "allow_symbol_change": true,
                "watchlist": [
                    "BITSTAMP:ETHUSD",
                    "BINANCE:BNBUSD"
                ],
                "details": true,
                "hotlist": true,
                "calendar": true,
                "studies": [
                    "STD;EMA"
                ],
                "show_popup_button": true,
                "popup_width": "1000",
                "popup_height": "650",
                "container_id": "tradingview_33f92"
            }
        );
    </script>
    </section>
<h1 id="market" class="text-center ">Our Market</h1>
    <section class="content-section my-3">
        <div class="left-content px-4">


                    <div class="col col-md-8 col-sm-9">
                        <div class="card-style-one">
                            {% for stock in stocks %}
                                <div class="single-card">
                                    <div class="card-content">
                                        <h4 class="card-title">
                                            <a href="javascript:void(0)">Nom: {{ stock.nom }}</a>
                                        </h4>
                                        <p class="text">
                                            Id: {{ stock.id }}, Nom: {{ stock.nom }}, Prix: {{ stock.prix }}, Quantite: {{ stock.quantite }}, Date: {{ stock.date ? stock.date|date('Y-m-d H:i:s') : '' }}
                                        </p>
                                    </div>
                                    <div class="button-container">
                                        <a class="btn btn-tertiary" href="{{ path('app_stock_show', {'id': stock.id}) }}">show</a>
                                        <a class="btn btn-tertiary mx-3 my-4" href="{{ path('app_marche_new', {'id': stock.id}) }}">Buy</a>
                                    </div>
                                </div>
                                <!-- single-card -->
                            {% endfor %}
                        </div>
                        <!-- card-style-one -->
                        {% if stocks|length == 0 %}
                            <div class="col-12 text-center">
                                <h1>No records found</h1>
                            </div>
                        {% endif %}
                    </div>
                    <!-- col -->
                </div>
                <!-- row -->

            <!-- container -->

        <!-- left-content -->

        <div class="right-content ">
            <canvas id="myChart" width="600" height="400"></canvas>
            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
            <script>
                const stocksCountByCompany = {{ stocksCountByCompany|json_encode|raw }};

                const labels = stocksCountByCompany.map(entry => entry.entreprise_name);
                const data = stocksCountByCompany.map(entry => entry.stocks_count);

                // Create chart
                const ctx = document.getElementById('myChart').getContext('2d');
                const myChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Stocks Count',
                            data: data,
                            backgroundColor: 'rgba(54, 162, 235, 0.5)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1,
                            borderRadius:3
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            </script>
        </div>
        <!-- right-content -->
    </section>
<section id="portfolio" class="my-5 px-4">
    <h1 class="text-center my-3">Portfolio</h1>

    <table class="table text-center">
        <thead>
        <tr>
            <th>Stock name</th>
            <th>Quantity</th>
            <th>Total</th>
            <th>Purchase Date</th>

        </tr>
        </thead>
        <tbody>
        {% for m in marches %}
            <tr>
                <td>{{ m.stock.id }}</td>
                <td>{{ m.quantite }}</td>
                <td>{{ m.total }}</td>
                <td>{{ m.dateAchat | date('Y-m-d H:i:s') }}</td>
                <td>
                    <a class="btn btn-tertiary"href="{{ path('app_marche_show', {'id': m.id}) }}">Show</a>
                    <a class="btn btn-tertiary" href="{{ path('app_marche_delete', {'id': m.id}) }}">Sell</a>
                </td>
            </tr>
        {% else %}
            <tr>
                <td colspan="11">no records found</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</section>
    <div class="alan-btn"></div>

{% endblock %}
